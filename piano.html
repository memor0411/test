<!DOCTYPE html>

<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ê°€ìƒ í”¼ì•„ë…¸ - í™”ìŒ ì„ íƒ</title>
  <style>
    body {
      background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      margin: 0;
      font-family: 'Arial', sans-serif;
      padding: 20px;
    }

```
h1 {
  color: white;
  margin-bottom: 20px;
  font-size: 2em;
  text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
}

.chord-selector {
  background: rgba(255,255,255,0.15);
  padding: 20px;
  border-radius: 10px;
  margin-bottom: 30px;
  backdrop-filter: blur(10px);
  display: flex;
  gap: 15px;
  align-items: center;
}

.chord-selector label {
  color: white;
  font-weight: bold;
  font-size: 16px;
}

.chord-btn {
  background: rgba(255,255,255,0.2);
  color: white;
  border: 2px solid rgba(255,255,255,0.3);
  padding: 10px 20px;
  border-radius: 8px;
  cursor: pointer;
  font-size: 14px;
  transition: all 0.3s;
  font-weight: bold;
}

.chord-btn:hover {
  background: rgba(255,255,255,0.3);
  transform: translateY(-2px);
}

.chord-btn.active {
  background: #4CAF50;
  border-color: #45a049;
  box-shadow: 0 4px 15px rgba(76, 175, 80, 0.4);
}

.piano-container {
  background: #333;
  padding: 20px 20px 30px 20px;
  border-radius: 10px;
  box-shadow: 0 10px 30px rgba(0,0,0,0.5);
}

.piano {
  display: flex;
  position: relative;
  height: 250px;
}

.key-container {
  position: relative;
  width: 60px;
}

.key {
  width: 60px;
  height: 250px;
  border: 1px solid #000;
  background: linear-gradient(to bottom, #fff 0%, #f5f5f5 100%);
  position: absolute;
  top: 0;
  left: 0;
  box-shadow: inset -2px 0 3px rgba(0,0,0,0.2), 0 2px 5px rgba(0,0,0,0.3);
  cursor: pointer;
  transition: all 0.1s;
  border-radius: 0 0 5px 5px;
}

.key:hover {
  background: linear-gradient(to bottom, #f0f0f0 0%, #e5e5e5 100%);
}

.key.black {
  width: 40px;
  height: 160px;
  background: linear-gradient(to bottom, #000 0%, #333 100%);
  position: absolute;
  top: 0;
  left: 50%;
  transform: translateX(-50%);
  z-index: 10;
  box-shadow: inset -2px 0 3px rgba(255,255,255,0.1), 0 5px 10px rgba(0,0,0,0.5);
  border-radius: 0 0 3px 3px;
}

.key.black:hover {
  background: linear-gradient(to bottom, #222 0%, #444 100%);
}

.key:active, .key.playing {
  transform: translateY(2px);
  box-shadow: inset 0 2px 5px rgba(0,0,0,0.3);
}

.key.black:active, .key.black.playing {
  transform: translateX(-50%) translateY(2px);
  background: linear-gradient(to bottom, #444 0%, #555 100%);
}

.note-label {
  position: absolute;
  bottom: 10px;
  left: 50%;
  transform: translateX(-50%);
  font-size: 12px;
  color: #666;
  font-weight: bold;
}

.key.black .note-label {
  color: #ccc;
  bottom: 5px;
  font-size: 10px;
}

.chord-display {
  background: rgba(255,255,255,0.1);
  padding: 15px 30px;
  border-radius: 10px;
  margin-top: 20px;
  color: white;
  font-size: 18px;
  min-height: 30px;
  backdrop-filter: blur(10px);
  text-align: center;
}

.instructions {
  color: white;
  margin-top: 20px;
  text-align: center;
  font-size: 14px;
  opacity: 0.8;
  max-width: 600px;
  line-height: 1.6;
}
```

  </style>
</head>
<body>

  <h1>ğŸ¹ ê°€ìƒ í”¼ì•„ë…¸ - í™”ìŒ ì„ íƒ</h1>

  <div class="chord-selector">
    <label>í™”ìŒ ì„ íƒ:</label>
    <button class="chord-btn active" data-chord="tonic">ìœ¼ëœ¸í™”ìŒ (I)</button>
    <button class="chord-btn" data-chord="subdominant">ë²„ê¸ˆë”¸ë¦¼í™”ìŒ (IV)</button>
    <button class="chord-btn" data-chord="dominant">ë”¸ë¦¼í™”ìŒ (V)</button>
  </div>

  <div class="piano-container">
    <div class="piano">
      <!-- C -->
      <div class="key-container">
        <div class="key" data-note="C">
          <span class="note-label">C</span>
        </div>
        <div class="key black" data-note="C#">
          <span class="note-label">C#</span>
        </div>
      </div>

```
  <!-- D -->
  <div class="key-container">
    <div class="key" data-note="D">
      <span class="note-label">D</span>
    </div>
    <div class="key black" data-note="D#">
      <span class="note-label">D#</span>
    </div>
  </div>
  
  <!-- E -->
  <div class="key-container">
    <div class="key" data-note="E">
      <span class="note-label">E</span>
    </div>
  </div>
  
  <!-- F -->
  <div class="key-container">
    <div class="key" data-note="F">
      <span class="note-label">F</span>
    </div>
    <div class="key black" data-note="F#">
      <span class="note-label">F#</span>
    </div>
  </div>
  
  <!-- G -->
  <div class="key-container">
    <div class="key" data-note="G">
      <span class="note-label">G</span>
    </div>
    <div class="key black" data-note="G#">
      <span class="note-label">G#</span>
    </div>
  </div>
  
  <!-- A -->
  <div class="key-container">
    <div class="key" data-note="A">
      <span class="note-label">A</span>
    </div>
    <div class="key black" data-note="A#">
      <span class="note-label">A#</span>
    </div>
  </div>
  
  <!-- B -->
  <div class="key-container">
    <div class="key" data-note="B">
      <span class="note-label">B</span>
    </div>
  </div>
</div>
```

  </div>

  <div class="chord-display" id="chordDisplay">í™”ìŒì„ ì„ íƒí•˜ê³  ê±´ë°˜ì„ í´ë¦­í•˜ì„¸ìš”</div>

  <div class="instructions">
    <strong>ìœ¼ëœ¸í™”ìŒ (I)</strong>: í•´ë‹¹ ìŒì„ ìœ¼ëœ¸ìŒìœ¼ë¡œ í•˜ëŠ” 3í™”ìŒ (1ë„-3ë„-5ë„)<br>
    <strong>ë²„ê¸ˆë”¸ë¦¼í™”ìŒ (IV)</strong>: í•´ë‹¹ ìŒì„ ë”¸ë¦¼ìŒìœ¼ë¡œ í•˜ëŠ” 3í™”ìŒ (4ë„-6ë„-1ë„)<br>
    <strong>ë”¸ë¦¼í™”ìŒ (V)</strong>: í•´ë‹¹ ìŒì„ ì´ë”ìŒìœ¼ë¡œ í•˜ëŠ” 3í™”ìŒ (5ë„-7ë„-2ë„)
  </div>

  <script>
    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
    const chordDisplay = document.getElementById('chordDisplay');
    let selectedChordType = 'tonic';

    // ìŒ ì£¼íŒŒìˆ˜ ì •ì˜
    const frequencies = {
      'C': 261.63, 'C#': 277.18, 'D': 293.66, 'D#': 311.13,
      'E': 329.63, 'F': 349.23, 'F#': 369.99, 'G': 392.00,
      'G#': 415.30, 'A': 440.00, 'A#': 466.16, 'B': 493.88,
      'C2': 523.25, 'C#2': 554.37, 'D2': 587.33, 'D#2': 622.25,
      'E2': 659.25, 'F2': 698.46, 'F#2': 739.99, 'G2': 783.99,
      'G#2': 830.61, 'A2': 880.00, 'A#2': 932.33, 'B2': 987.77
    };

    // ìŒê³„ ë°°ì—´
    const noteOrder = ['C', 'C#', 'D', 'D#', 'E', 'F', 'F#', 'G', 'G#', 'A', 'A#', 'B'];

    // íŠ¹ì • ìŒì—ì„œ ë°˜ìŒ ê°„ê²©ë§Œí¼ ë–¨ì–´ì§„ ìŒ ì°¾ê¸°
    function getNoteByInterval(rootNote, semitones) {
      const rootIndex = noteOrder.indexOf(rootNote);
      let targetIndex = (rootIndex + semitones) % 12;
      // ìŒìˆ˜ ì¸ë±ìŠ¤ ì²˜ë¦¬
      if (targetIndex < 0) targetIndex += 12;
      
      const octaveShift = Math.floor((rootIndex + semitones) / 12);
      const targetNote = noteOrder[targetIndex];
      return octaveShift > 0 ? targetNote + '2' : targetNote;
    }

    // í™”ìŒ ìƒì„± í•¨ìˆ˜
    function getChord(rootNote, chordType) {
      let intervals, chordName;
      
      if (chordType === 'tonic') {
        // ìœ¼ëœ¸í™”ìŒ (I): 1ë„-3ë„-5ë„ (0, 4, 7 ë°˜ìŒ)
        intervals = [0, 4, 7];
        chordName = `${rootNote} ìœ¼ëœ¸í™”ìŒ (I)`;
      } else if (chordType === 'subdominant') {
        // ë²„ê¸ˆë”¸ë¦¼í™”ìŒ (IV): í•´ë‹¹ ìŒì„ 5ë„ë¡œ í•˜ëŠ” í™”ìŒ
        // Fì˜ ë²„ê¸ˆë”¸ë¦¼í™”ìŒ = C-F-A (Cê°€ 4ë„, Fê°€ ìœ¼ëœ¸ìŒ)
        intervals = [5, 0, 4]; // ì•„ë˜ 5ë„ + ìœ¼ëœ¸ìŒ + ìœ„ 3ë„
        const subdominantRoot = getNoteByInterval(rootNote, 5);
        chordName = `${rootNote} ë²„ê¸ˆë”¸ë¦¼í™”ìŒ (IV)`;
      } else if (chordType === 'dominant') {
        // ë”¸ë¦¼í™”ìŒ (V): í•´ë‹¹ ìŒì„ ìœ¼ëœ¸ìŒìœ¼ë¡œ í•˜ëŠ” 5ë„ ìœ„ í™”ìŒ
        intervals = [7, 11, 14]; // 5ë„ + 7ë„ + 9ë„(2ë„)
        chordName = `${rootNote} ë”¸ë¦¼í™”ìŒ (V)`;
      }

      const notes = intervals.map(interval => getNoteByInterval(rootNote, interval));
      const freqs = notes.map(note => {
        const freq = frequencies[note];
        if (!freq) {
          console.error(`ì£¼íŒŒìˆ˜ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: ${note}`);
          return frequencies[rootNote]; // ê¸°ë³¸ê°’ ë°˜í™˜
        }
        return freq;
      });
      
      return { frequencies: freqs, name: chordName, notes: notes };
    }

    function playChord(freqs, duration = 1.5) {
      freqs.forEach((frequency, index) => {
        const oscillator = audioContext.createOscillator();
        const gainNode = audioContext.createGain();

        oscillator.type = 'triangle';
        oscillator.frequency.setValueAtTime(frequency, audioContext.currentTime);

        const baseVolume = index === 0 ? 0.25 : 0.15;
        
        gainNode.gain.setValueAtTime(0, audioContext.currentTime);
        gainNode.gain.linearRampToValueAtTime(baseVolume, audioContext.currentTime + 0.02);
        gainNode.gain.exponentialRampToValueAtTime(baseVolume * 0.5, audioContext.currentTime + 0.2);
        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration);

        oscillator.connect(gainNode);
        gainNode.connect(audioContext.destination);

        oscillator.start(audioContext.currentTime);
        oscillator.stop(audioContext.currentTime + duration);
      });
    }

    // í™”ìŒ ì„ íƒ ë²„íŠ¼
    document.querySelectorAll('.chord-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.chord-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        selectedChordType = btn.dataset.chord;
      });
    });

    // ê±´ë°˜ í´ë¦­
    document.querySelectorAll('.key').forEach(key => {
      key.addEventListener('click', () => {
        const note = key.dataset.note;
        const chord = getChord(note, selectedChordType);
        
        if (audioContext.state === 'suspended') {
          audioContext.resume();
        }
        
        key.classList.add('playing');
        setTimeout(() => key.classList.remove('playing'), 300);
        
        const noteNames = chord.notes.map(n => n.replace('2', '')).join(' - ');
        chordDisplay.textContent = `${chord.name}: ${noteNames}`;
        
        playChord(chord.frequencies);
      });

      key.addEventListener('mousedown', (e) => {
        e.preventDefault();
      });
    });

    // í‚¤ë³´ë“œ ì§€ì›
    const keyMap = {
      'a': 'C', 'w': 'C#', 's': 'D', 'e': 'D#',
      'd': 'E', 'f': 'F', 't': 'F#', 'g': 'G',
      'y': 'G#', 'h': 'A', 'u': 'A#', 'j': 'B'
    };

    document.addEventListener('keydown', (e) => {
      const note = keyMap[e.key.toLowerCase()];
      if (note) {
        const key = document.querySelector(`[data-note="${note}"]`);
        if (key && !key.classList.contains('playing')) {
          key.click();
        }
      }
    });
  </script>

</body>
</html>