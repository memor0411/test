<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ê°€ìƒ í”¼ì•„ë…¸ ğŸ¹</title>
  <style>
    body {
      background: #222;
      color: white;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
      margin: 0;
      font-family: sans-serif;
      user-select: none;
    }

    h1 {
      margin-bottom: 10px;
    }

    select {
      padding: 6px 10px;
      font-size: 16px;
      margin-bottom: 20px;
      border-radius: 5px;
      border: none;
    }

    .piano {
      display: flex;
      position: relative;
    }

    .key {
      width: 60px;
      height: 250px;
      border: 1px solid #000;
      background: white;
      position: relative;
      z-index: 1;
      box-shadow: inset -2px 0 3px rgba(0,0,0,0.3);
      cursor: pointer;
      transition: background 0.1s;
    }

    .key.black {
      width: 40px;
      height: 160px;
      background: black;
      position: absolute;
      top: 0;
      z-index: 2;
      margin-left: -20px;
      box-shadow: inset -2px 0 3px rgba(255,255,255,0.1);
    }

    .key:active,
    .key.active {
      background: #ddd;
    }

    .key.black:active,
    .key.black.active {
      background: #333;
    }

    .note-label {
      position: absolute;
      bottom: 10px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 14px;
      color: #333;
    }

    .key.black .note-label {
      color: #fff;
      bottom: 5px;
      font-size: 12px;
    }
  </style>
</head>
<body>

  <h1>ğŸµ ê°€ìƒ í”¼ì•„ë…¸</h1>
  <label for="octaveSelect">ì˜¥íƒ€ë¸Œ ì„ íƒ:</label>
  <select id="octaveSelect">
    <option value="2">2 ì˜¥íƒ€ë¸Œ</option>
    <option value="3">3 ì˜¥íƒ€ë¸Œ</option>
  </select>

  <div class="piano" id="piano"></div>

  <script>
    const base = "https://cdn.jsdelivr.net/gh/gleitz/midi-js-soundfonts/FluidR3_GM/acoustic_grand_piano-mp3/";

    // ê° ì˜¥íƒ€ë¸Œ ìŒê³„ ì •ì˜
    const noteNames = ["C", "C#", "D", "D#", "E", "F", "F#", "G", "G#", "A", "A#", "B"];

    // í‚¤ë³´ë“œ ë§¤í•‘ (ê¸°ë³¸ 1ì˜¥íƒ€ë¸Œ ê¸°ì¤€)
    const keyboardMap = [
      "a","w","s","e","d","f","t","g","y","h","u","j",
      "k","o","l","p",";","'","[","]"
    ];

    // ìŒì› ê²½ë¡œ ìƒì„±
    function getNoteURL(note, octave) {
      const name = note.replace("#", "s");
      return `${base}${name}${octave}.mp3`;
    }

    // í”¼ì•„ë…¸ ë Œë”ë§
    function renderPiano(octaves = 2) {
      const piano = document.getElementById("piano");
      piano.innerHTML = ""; // ì´ˆê¸°í™”

      let keyIndex = 0;
      for (let o = 3; o < 3 + octaves; o++) {
        noteNames.forEach(note => {
          const key = document.createElement("div");
          key.classList.add("key");
          key.dataset.note = `${note}${o}`;
          key.dataset.octave = o;
          key.dataset.sound = getNoteURL(note, o);

          // í‚¤ë³´ë“œ ë§¤í•‘
          if (keyboardMap[keyIndex]) key.dataset.key = keyboardMap[keyIndex];
          keyIndex++;

          const label = document.createElement("div");
          label.classList.add("note-label");
          label.textContent = note + o;
          key.appendChild(label);

          piano.appendChild(key);
        });
      }

      // ë¸”ë™ í‚¤ ìŠ¤íƒ€ì¼ ìœ„ì¹˜ ì¡°ì •
      const whites = piano.querySelectorAll(".key");
      whites.forEach((key, i) => {
        const note = key.dataset.note;
        if (note.includes("#")) {
          key.classList.add("black");
          key.style.left = `${i * 60 - 20}px`;
        }
      });

      // í™”ì´íŠ¸ í‚¤ ë°°ì¹˜
      piano.querySelectorAll(".key:not(.black)").forEach((key, i) => {
        key.style.marginLeft = "0";
      });

      // í´ë¦­ ì´ë²¤íŠ¸ ë“±ë¡
      document.querySelectorAll(".key").forEach(key => {
        key.addEventListener("click", () => playNote(key));
      });
    }

    // ì†Œë¦¬ ì¬ìƒ í•¨ìˆ˜
    function playNote(key) {
      const sound = key.dataset.sound;
      const audio = new Audio(sound);
      audio.currentTime = 0;
      audio.play();

      key.classList.add("active");
      setTimeout(() => key.classList.remove("active"), 150);
    }

    // í‚¤ë³´ë“œ ì´ë²¤íŠ¸
    document.addEventListener("keydown", e => {
      const key = document.querySelector(`.key[data-key="${e.key.toLowerCase()}"]`);
      if (key && !key.classList.contains("active")) {
        playNote(key);
      }
    });

    // ì˜¥íƒ€ë¸Œ ë³€ê²½ ì‹œ ë‹¤ì‹œ ë Œë”ë§
    document.getElementById("octaveSelect").addEventListener("change", e => {
      renderPiano(parseInt(e.target.value));
    });

    // ê¸°ë³¸ 2ì˜¥íƒ€ë¸Œë¡œ ì‹œì‘
    renderPiano(2);
  </script>

</body>
</html>