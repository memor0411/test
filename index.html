<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>장조 코드 피아노</title>
  <style>
    body {
      background: #222;
      color: white;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      height: 100vh;
      margin: 0;
      font-family: sans-serif;
    }
    h1 {
      margin-top: 20px;
    }
    select {
      margin: 20px;
      padding: 5px 10px;
      font-size: 16px;
    }
    .piano {
      display: flex;
      position: relative;
      user-select: none;
    }
    .key {
      width: 60px;
      height: 250px;
      border: 1px solid #000;
      background: white;
      position: relative;
      z-index: 1;
      box-shadow: inset -2px 0 3px rgba(0, 0, 0, 0.3);
      cursor: pointer;
      display: flex;
      align-items: flex-end;
      justify-content: center;
      font-weight: bold;
      font-size: 14px;
      color: black;
    }
    .key.black {
      width: 40px;
      height: 160px;
      background: black;
      position: absolute;
      top: 0;
      z-index: 2;
      margin-left: -20px;
      box-shadow: inset -2px 0 3px rgba(255, 255, 255, 0.1);
      color: white;
    }
    .key:active {
      background: #ddd;
    }
    .key.black:active {
      background: #333;
    }
  </style>
</head>
<body>
  <h1>🎵 장조 코드 피아노</h1>
  <label for="scale">장조 선택:</label>
  <select id="scale">
    <option value="C">도 - 다장조</option>
    <option value="D">레 - 라장조</option>
    <option value="E">미 - 마장조</option>
    <option value="F">파 - 바장조</option>
    <option value="G">솔 - 사장조</option>
    <option value="A">라 - 가장조</option>
    <option value="B">시 - 나장조</option>
  </select>

  <div class="piano" id="piano">
    <!-- White keys -->
    <div class="key" data-note="C">C</div>
    <div class="key" data-note="D">D</div>
    <div class="key" data-note="E">E</div>
    <div class="key" data-note="F">F</div>
    <div class="key" data-note="G">G</div>
    <div class="key" data-note="A">A</div>
    <div class="key" data-note="B">B</div>

    <!-- Black keys -->
    <div class="key black" style="left: 45px;" data-note="C#">C#</div>
    <div class="key black" style="left: 105px;" data-note="D#">D#</div>
    <div class="key black" style="left: 225px;" data-note="F#">F#</div>
    <div class="key black" style="left: 285px;" data-note="G#">G#</div>
    <div class="key black" style="left: 345px;" data-note="A#">A#</div>
  </div>

  <script>
    // 오디오 음원 URL (기존과 동일)
    const audioBase = 'https://piano-sounds.s3.us-east-2.amazonaws.com/';
    const noteFiles = {
      'C': 'C.mp3', 'C#': 'Cs.mp3',
      'D': 'D.mp3', 'D#': 'Ds.mp3',
      'E': 'E.mp3',
      'F': 'F.mp3', 'F#': 'Fs.mp3',
      'G': 'G.mp3', 'G#': 'Gs.mp3',
      'A': 'A.mp3', 'A#': 'As.mp3',
      'B': 'B.mp3'
    };

    const NOTES = ['C', 'C#', 'D', 'D#', 'E', 'F', 'F#', 'G', 'G#', 'A', 'A#', 'B'];
    const majorScaleSteps = [0, 2, 4, 5, 7, 9, 11];
    const chordTypes = ['maj', 'min', 'min', 'maj', 'maj', 'min', 'dim'];

    // 코드 음 계산 함수
    function getChordNotes(rootIndex, type) {
      let intervals;
      if (type === 'maj') intervals = [0, 4, 7];
      else if (type === 'min') intervals = [0, 3, 7];
      else if (type === 'dim') intervals = [0, 3, 6];
      return intervals.map(i => NOTES[(rootIndex + i) % 12]);
    }

    // 선택한 장조 기준으로 다이어토닉 코드들 만들기
    function getScaleChords(keyNote) {
      const keyIndex = NOTES.indexOf(keyNote);
      const chords = {};
      for(let i=0; i<majorScaleSteps.length; i++){
        const rootIndex = (keyIndex + majorScaleSteps[i]) % 12;
        const chord = getChordNotes(rootIndex, chordTypes[i]);
        chords[NOTES[rootIndex]] = chord;
      }
      return chords;
    }

    let currentKey = 'C';
    let currentChords = getScaleChords(currentKey);

    document.getElementById('scale').addEventListener('change', e => {
      currentKey = e.target.value;
      currentChords = getScaleChords(currentKey);
    });

    document.querySelectorAll('.key').forEach(key => {
      key.addEventListener('click', () => {
        const note = key.dataset.note;
        const chord = currentChords[note];

        if (chord) {
          // 여러 음 동시에 재생
          chord.forEach(n => {
            const audio = new Audio(audioBase + noteFiles[n]);
            audio.currentTime = 0;
            audio.play();
          });
        } else {
          // 단일 음 재생
          if(noteFiles[note]){
            const audio = new Audio(audioBase + noteFiles[note]);
            audio.currentTime = 0;
            audio.play();
          }
        }
      });
    });
  </script>
</body>
</html>

